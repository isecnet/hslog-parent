webpackJsonp([25],{"7TKI":function(e,t){},"t8+U":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("ID1p"),a=i("qTy0"),o=i("/sA3"),s=i("8+FI"),l={name:"equipment",data:function(){var e=this;return{busName:"searchEquipment",busNames:{selectionName:"equipmentDelect"},page:1,c_page:1,size:15,logBaseJson:[],logType:[],typeArr:[],formConditionsArr:[],searchConditions:{name:"",hostname:"",ip:"",logType:""},saveCondition:"",tableHead:[{prop:"name",label:"资产名称",width:"",formatData:function(e,t){return e+' <b title="今日入库日志数 " class="inNum" style="border: 1px solid #e4956d;color: #e4956d;padding: 0 5px;">'+t.log_count+"</b>"}},{prop:"hostName",label:"主机名",width:""},{prop:"type",label:"资产类型",width:"",formatData:function(t){var i="",n=t.substring(0,2);for(var a in e.typeArr){var o=e.typeArr[a];if(o.value==n){for(var s in i+=o.label+"-",o.children)if(o.children[s].value==t){i+=o.children[s].label;break}break}}return i}},{prop:"logType",label:"日志类型",width:""},{prop:"ip",label:"IP地址",width:"125"},{prop:"domain",label:"根域名",width:""},{prop:"端口",label:"port",width:""},{prop:"startUp",label:"是否启用",width:"",formatData:function(e){return"1"==e?"是":"否"}},{prop:"createTime",label:"创建时间",width:"",formatData:function(e){return e.split(".")[0]}},{prop:"tools",label:"操作",width:"",btns:[{icon:"el-icon-edit",text:"修改资产",clickFun:function(t,i){e.reviseEquipment(t,i)}},{icon:"el-icon-tickets",text:"查看资产日志",clickFun:function(t,i){e.equipmentLogs(t,i)}},{icon:"el-icon-share",text:"查看资产图表",btnType:"equipmentEcharts",clickFun:function(t,i){e.equipmentEcharts(t,i)}},{icon:"el-icon-date",text:"查看资产事件",btnType:"equipmentEvents",clickFun:function(t,i){e.equipmentEvents(t,i)}},{icon:"el-icon-bell",text:"设置安全策略",btnType:"setSafe",clickFun:function(t,i){e.setSafe(t,i)}},{icon:"el-icon-view",text:"潜在威胁分析",btnType:"theartAnalyse",clickFun:function(t,i){e.theartAnalyse(t,i)}}]},{prop:"threats",label:"",width:"70",formatData:function(e,t){var i="";return 0!==t.high_risk&&(i+='<span title="高危事件数'+t.high_risk+'" style="display:inline-block;width: 20px;height:20px;border-radius: 100%;background: #f55446;text-align: center">'+t.high_risk+"</span>"),0!==t.moderate_risk&&(i+='<span title="中危事件数'+t.moderate_risk+'" style="display:inline-block;width: 20px;height:20px;border-radius: 100%;background: #f1ae09;text-align: center">'+t.moderate_risk+"</span>"),i}}],tableData:[],firstGetData:!0,allCounts:0,selectEquipmentId:"",delectEquipmentIds:""}},created:function(){var e=this;this.getLogType(),this.getEquipmentType(),this.formConditionsArr=[{label:"资产名称",paramName:"name",model:{model:""},itemType:"",type:"input"},{label:"IP地址",paramName:"ip",itemType:"",model:{model:""},type:"input"},{label:"主机名",paramName:"hostname",model:{model:""},itemType:"",type:"input"},{label:"日志类型",paramName:"logType",type:"select",itemType:"",model:{model:""},options:this.logType},{label:"资产类型",paramName:"type",type:"cascader",itemType:"",model:{model:[]},options:[]}],s.default.$on(this.busName,function(t){e.searchConditions=t,e.getEquipmentList(e.searchConditions,1),e.c_page=1}),s.default.$on(this.busNames.selectionName,function(t){for(var i in e.delectEquipmentIds="",t)e.delectEquipmentIds+=t[i].id+","})},mounted:function(){},methods:{getLogType:function(){var e=this;this.$nextTick(function(){e.$axios.get("static/filejson/logTypeLevel.json",{}).then(function(t){e.logBaseJson=t.data,e.logType.push({value:"",label:"全部"});for(var i=0;i<t.data.length;i++){var n={value:t.data[i].type,label:t.data[i].type};e.logType.push(n)}}).catch(function(e){console.log(e)})})},getEquipmentType:function(){var e=this;this.$nextTick(function(){e.$axios.get("static/filejson/equiptype.json",{}).then(function(t){e.typeArr=t.data,e.formConditionsArr[e.formConditionsArr.length-1].options=e.typeArr}).catch(function(e){console.log(e)})})},getEquipmentList:function(e,t){var i=this,n=e;n.pageIndex=t,n.pageSize=this.size,this.$nextTick(function(){layer.load(1),i.$axios.post(i.$baseUrl+"/equipment/selectPage.do",i.$qs.stringify(n)).then(function(e){layer.closeAll("loading"),i.tableData=e.data[0].equipment,i.allCounts=JSON.parse(e.data[0].count.count),i.saveCondition=i.searchConditions}).catch(function(e){layer.closeAll("loading"),console.log(e)})})},selectEquipment:function(){var e=this;this.$nextTick(function(){layer.load(1),e.$axios.post(e.$baseUrl+"/equipment/selectEquipmentByLog.do",e.$qs.stringify({id:e.selectEquipmentId})).then(function(t){if(layer.closeAll("loading"),"false"===t.data.success)layer.msg(t.data.message,{icon:5});else{for(var i=t.data.equipment,n=0;n<i.length;n++){i[n].createTime&&(i[n].createTime=i[n].createTime.split(".")[0]),i[n].upDateTime&&(i[n].upDateTime=i[n].upDateTime.split(".")[0]),i[n].endTime&&(i[n].endTime=i[n].endTime.split(".")[0]),"1"==i[n].startUp?i[n].startUp="是":i[n].startUp="否";var a="",o=i[n].type.substring(0,2);for(var s in e.typeArr){var l=e.typeArr[s];if(l.value==o){for(var r in a+=l.label+"-",l.children)if(l.children[r].value==i[n].type){a+=l.children[r].label;break}break}}i[n].type=a}e.tableData=i}}).catch(function(e){layer.closeAll("loading")})})},handleCurrentChange:function(e){this.getEquipmentList(this.saveCondition,e),this.firstGetData=!1},goToAddEquipment:function(){this.$router.push({path:"addEquipment"})},goToAllEcharts:function(){this.$router.push({path:"allEcharts"})},removeEquipment:function(){var e=this;""===this.delectEquipmentIds?layer.msg("未选中任何资产",{icon:5}):layer.confirm("您确定删除么？",{btn:["确定","取消"]},function(t){layer.close(t),e.$nextTick(function(){e.$axios.post(e.$baseUrl+"/equipment/delete.do",e.$qs.stringify({id:e.delectEquipmentIds})).then(function(t){"true"==t.data.success?(layer.msg("删除成功",{icon:1}),e.getEquipmentList(e.searchConditions,1),e.c_page=1):layer.msg("删除失败",{icon:5})}).catch(function(e){layer.msg("删除失败",{icon:5})})})},function(){layer.close()})},reviseEquipment:function(e,t){Object(o.f)("reviseEquipment"+e.id,"equipment/reviseEquipment.vue",{name:e.name,id:e.id},"资产修改")},equipmentLogs:function(e,t){Object(o.f)("equipmentLogs"+e.id,"logsManage/equipmentLogs.vue",{name:e.name,id:e.id,logType:e.logType},"日志")},equipmentEcharts:function(e,t){Object(o.f)("equipmentEcharts"+e.id,"equipment/equipmentEcharts.vue",{name:e.name,id:e.id,logType:e.logType},"统计")},equipmentEvents:function(e,t){Object(o.f)("equipmentEvents"+e.id,"eventManage/equipmentEvents.vue",{name:e.name,id:e.id},"事件")},setSafe:function(e,t){Object(o.f)("equipmentSafe"+e.id,"equipment/equipmentSafe.vue",{name:e.name,id:e.id,logType:e.logType},"安全策略")},theartAnalyse:function(e,t){Object(o.f)("equipmentThreat"+e.id,"equipment/equipmentThreat.vue",{name:e.name,id:e.id,logType:e.logType},"威胁分析")}},watch:{$route:function(e,t){"addEquipment"!==t.name&&-1===t.name.indexOf("reviseEquipment")||(this.getEquipmentList(this.searchConditions,1),this.c_page=1)}},beforeRouteEnter:function(e,t,i){i(function(t){void 0!==e.params.equipmentid?(t.selectEquipmentId=e.params.equipmentid,t.selectEquipment()):t.getEquipmentList(t.searchConditions,1)})},components:{vSearchForm:n.default,vBasetable:a.default}},r={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"content-bg"},[i("div",{staticClass:"top-title"},[e._v("资产管理")]),e._v(" "),i("div",{staticClass:"equipment-tools"},[i("div",{staticClass:"equipemnt-tools-btns"},[i("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:e.goToAddEquipment}},[e._v("添加资产")]),e._v(" "),i("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:e.removeEquipment}},[e._v("删除资产")]),e._v(" "),i("el-button",{attrs:{type:"success",size:"mini",plain:""},on:{click:e.goToAllEcharts}},[e._v("报表")])],1),e._v(" "),i("div",{staticClass:"equipemnt-tools-form"},[i("v-search-form",{attrs:{formItem:e.formConditionsArr,busName:e.busName}})],1)]),e._v(" "),i("div",{staticClass:"equipment-table-wapper"},[i("v-basetable",{attrs:{selection:!0,tableHead:e.tableHead,tableData:e.tableData,busName:e.busNames}})],1),e._v(" "),i("div",{staticClass:"equipment-table-page"},[i("span",[e._v("共检索到资产数量为 "),i("b",[e._v(e._s(e.allCounts))]),e._v(" 台")]),e._v(" "),i("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":e.c_page,"page-size":e.size,total:e.allCounts},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.c_page=t}}})],1)])},staticRenderFns:[]};var p=i("VU/8")(l,r,!1,function(e){i("7TKI")},"data-v-47045d63",null);t.default=p.exports}});