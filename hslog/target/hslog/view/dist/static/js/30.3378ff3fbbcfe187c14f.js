webpackJsonp([30],{"O/R2":function(e,t){},"t8+U":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("ID1p"),a=n("qTy0"),o=n("/sA3"),s=n("8+FI"),l={name:"equipment",data:function(){var e=this;return{busName:"searchEquipment",busNames:{selectionName:"equipmentDelect"},page:1,c_page:1,size:15,logBaseJson:[],logType:[],typeArr:[],formConditionsArr:[],searchConditions:{name:"",hostname:"",ip:"",logType:""},saveCondition:"",tableHead:[{prop:"name",label:"资产名称",width:"",formatData:function(e,t){return e+' <b title="今日入库日志数 " class="inNum" style="border: 1px solid #e4956d;color: #e4956d;padding: 0 5px;">'+t.log_count+"</b>"}},{prop:"hostName",label:"主机名",width:""},{prop:"type",label:"资产类型",width:"",formatData:function(t){var n="",i=t.substring(0,2);for(var a in e.typeArr){var o=e.typeArr[a];if(o.value==i){for(var s in n+=o.label+"-",o.children)if(o.children[s].value==t){n+=o.children[s].label;break}break}}return n}},{prop:"logType",label:"日志类型",width:""},{prop:"ip",label:"IP地址",width:"125"},{prop:"domain",label:"根域名",width:""},{prop:"端口",label:"port",width:""},{prop:"startUp",label:"是否启用",width:"",formatData:function(e){return"1"==e?"是":"否"}},{prop:"createTime",label:"创建时间",width:"",formatData:function(e){return e.split(".")[0]}},{prop:"tools",label:"操作",width:"",btns:[{icon:"el-icon-edit",text:"修改资产",clickFun:function(t,n){e.reviseEquipment(t,n)}},{icon:"el-icon-tickets",text:"查看资产日志",clickFun:function(t,n){e.equipmentLogs(t,n)}},{icon:"el-icon-share",text:"查看资产图表",btnType:"equipmentEcharts",clickFun:function(t,n){e.equipmentEcharts(t,n)}},{icon:"el-icon-date",text:"查看资产事件",btnType:"equipmentEvents",clickFun:function(t,n){e.equipmentEvents(t,n)}},{icon:"el-icon-bell",text:"设置安全策略",btnType:"setSafe",clickFun:function(t,n){e.setSafe(t,n)}},{icon:"el-icon-view",text:"潜在威胁分析",btnType:"theartAnalyse",clickFun:function(t,n){e.theartAnalyse(t,n)}}]},{prop:"threats",label:"",width:"70",formatData:function(e,t){var n="";return 0!==t.high_risk&&(n+='<span title="高危事件数'+t.high_risk+'" style="display:inline-block;width: 20px;height:20px;border-radius: 100%;background: #f55446;text-align: center">'+t.high_risk+"</span>"),0!==t.moderate_risk&&(n+='<span title="中危事件数'+t.moderate_risk+'" style="display:inline-block;width: 20px;height:20px;border-radius: 100%;background: #f1ae09;text-align: center">'+t.moderate_risk+"</span>"),n}}],tableData:[],firstGetData:!0,allCounts:0,selectEquipmentId:"",delectEquipmentIds:""}},created:function(){var e=this;this.getLogType(),this.getEquipmentType(),this.formConditionsArr=[{label:"资产名称",paramName:"name",model:{model:""},itemType:"",type:"input"},{label:"IP地址",paramName:"ip",itemType:"",model:{model:""},type:"input"},{label:"主机名",paramName:"hostname",model:{model:""},itemType:"",type:"input"},{label:"日志类型",paramName:"logType",type:"select",itemType:"",model:{model:""},options:this.logType},{label:"资产类型",paramName:"type",type:"cascader",itemType:"",model:{model:[]},options:[]}],s.default.$on(this.busName,function(t){e.searchConditions=t,e.getEquipmentList(e.searchConditions,1),e.c_page=1}),s.default.$on(this.busNames.selectionName,function(t){for(var n in e.delectEquipmentIds="",t)e.delectEquipmentIds+=t[n].id+","})},mounted:function(){},methods:{getLogType:function(){var e=this;this.$nextTick(function(){e.$axios.get("static/filejson/logTypeLevel.json",{}).then(function(t){e.logBaseJson=t.data,e.logType.push({value:"",label:"全部"});for(var n=0;n<t.data.length;n++){var i={value:t.data[n].type,label:t.data[n].type};e.logType.push(i)}}).catch(function(e){console.log(e)})})},getEquipmentType:function(){var e=this;this.$nextTick(function(){e.$axios.get("static/filejson/equiptype.json",{}).then(function(t){e.typeArr=t.data,e.formConditionsArr[e.formConditionsArr.length-1].options=e.typeArr}).catch(function(e){console.log(e)})})},getEquipmentList:function(e,t){var n=this,i=e;i.pageIndex=t,i.pageSize=this.size,this.$nextTick(function(){layer.load(1),n.$axios.post(n.$baseUrl+"/equipment/selectPage.do",n.$qs.stringify(i)).then(function(e){layer.closeAll("loading"),n.tableData=e.data[0].equipment,n.allCounts=JSON.parse(e.data[0].count.count),n.saveCondition=n.searchConditions}).catch(function(e){layer.closeAll("loading"),console.log(e)})})},selectEquipment:function(){var e=this;this.$nextTick(function(){layer.load(1),e.$axios.post(e.$baseUrl+"/equipment/selectEquipmentByLog.do",e.$qs.stringify({id:e.selectEquipmentId})).then(function(t){if(layer.closeAll("loading"),"false"===t.data.success)layer.msg(t.data.message,{icon:5});else{for(var n=t.data.equipment,i=0;i<n.length;i++){n[i].createTime&&(n[i].createTime=n[i].createTime.split(".")[0]),n[i].upDateTime&&(n[i].upDateTime=n[i].upDateTime.split(".")[0]),n[i].endTime&&(n[i].endTime=n[i].endTime.split(".")[0]),"1"==n[i].startUp?n[i].startUp="是":n[i].startUp="否";var a="",o=n[i].type.substring(0,2);for(var s in e.typeArr){var l=e.typeArr[s];if(l.value==o){for(var r in a+=l.label+"-",l.children)if(l.children[r].value==n[i].type){a+=l.children[r].label;break}break}}n[i].type=a}e.tableData=n}}).catch(function(e){layer.closeAll("loading")})})},handleCurrentChange:function(e){this.getEquipmentList(this.saveCondition,e),this.firstGetData=!1},goToAddEquipment:function(){this.$router.push({path:"addEquipment"})},goToAllEcharts:function(){this.$router.push({path:"allEcharts"})},removeEquipment:function(){var e=this;""===this.delectEquipmentIds?layer.msg("未选中任何资产",{icon:5}):layer.confirm("您确定删除么？",{btn:["确定","取消"]},function(t){layer.close(t),e.$nextTick(function(){e.$axios.post(e.$baseUrl+"/equipment/delete.do",e.$qs.stringify({id:e.delectEquipmentIds})).then(function(t){"true"==t.data.success?(layer.msg("删除成功",{icon:1}),e.getEquipmentList(e.searchConditions,1),e.c_page=1):layer.msg("删除失败",{icon:5})}).catch(function(e){layer.msg("删除失败",{icon:5})})})},function(){layer.close()})},reviseEquipment:function(e,t){Object(o.f)("reviseEquipment"+e.id,"equipment/reviseEquipment.vue",{name:e.name,id:e.id},"资产修改")},equipmentLogs:function(e,t){Object(o.f)("equipmentLogs"+e.id,"logsManage/equipmentLogs.vue",{name:e.name,id:e.id,logType:e.logType},"日志")},equipmentEcharts:function(e,t){Object(o.f)("equipmentEcharts"+e.id,"equipment/equipmentEcharts.vue",{name:e.name,id:e.id,logType:e.logType},"统计")},equipmentEvents:function(e,t){Object(o.f)("equipmentEvents"+e.id,"eventManage/equipmentEvents.vue",{name:e.name,id:e.id},"事件")},setSafe:function(e,t){Object(o.f)("equipmentSafe"+e.id,"equipment/equipmentSafe.vue",{name:e.name,id:e.id,logType:e.logType},"安全策略")},theartAnalyse:function(e,t){Object(o.f)("equipmentThreat"+e.id,"equipment/equipmentThreat.vue",{name:e.name,id:e.id,logType:e.logType},"威胁分析")}},watch:{$route:function(e,t){"addEquipment"!==t.name&&-1===t.name.indexOf("reviseEquipment")||(this.getEquipmentList(this.searchConditions,1),this.c_page=1)}},beforeRouteEnter:function(e,t,n){n(function(t){void 0!==e.params.equipmentid?(t.selectEquipmentId=e.params.equipmentid,t.selectEquipment()):t.getEquipmentList(t.searchConditions,1)})},components:{vSearchForm:i.default,vBasetable:a.default}},r={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content-bg"},[n("div",{staticClass:"top-title"},[e._v("资产管理")]),e._v(" "),n("div",{staticClass:"equipment-tools"},[n("div",{staticClass:"equipemnt-tools-btns"},[n("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:e.goToAddEquipment}},[e._v("添加资产")]),e._v(" "),n("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:e.removeEquipment}},[e._v("删除资产")]),e._v(" "),n("el-button",{attrs:{type:"success",size:"mini",plain:""},on:{click:e.goToAllEcharts}},[e._v("报表")])],1),e._v(" "),n("div",{staticClass:"equipemnt-tools-form"},[n("v-search-form",{attrs:{formItem:e.formConditionsArr,busName:e.busName}})],1)]),e._v(" "),n("div",{staticClass:"equipment-table-wapper"},[n("v-basetable",{attrs:{selection:!0,tableHead:e.tableHead,tableData:e.tableData,busName:e.busNames}})],1),e._v(" "),n("div",{staticClass:"equipment-table-page"},[n("span",[e._v("共检索到资产数量为 "),n("b",[e._v(e._s(e.allCounts))]),e._v(" 台")]),e._v(" "),n("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":e.c_page,"page-size":e.size,total:e.allCounts},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.c_page=t},"update:current-page":function(t){e.c_page=t}}})],1)])},staticRenderFns:[]};var p=n("C7Lr")(l,r,!1,function(e){n("O/R2")},"data-v-6092f396",null);t.default=p.exports}});