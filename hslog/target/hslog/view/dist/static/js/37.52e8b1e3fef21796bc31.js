webpackJsonp([37],{D4KA:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("aA9S"),r=a.n(s),l=a("3cXf"),n=a.n(l),o=a("ID1p"),i=a("qTy0"),c=a("6EjU"),d=a("/sA3"),u=a("8+FI"),m={name:"roleExplain",data:function(){var e=this;return{busName:{selectionName:"userSelect",reviseUserName:"reviseUserName"},mode:0,middleCheck:{background:"#ffaf56"},hideCheck:{background:"#6ba001"},treeKey:"",treeForm:!1,userForm:!1,clickModal:!1,props:{label:"name",isLeaf:"leaf"},fatherName:"",departmentParams:{level:1,subordinate:0,departmentNodeId:0,name:"",comment:""},userParams:{name:"",sex:1,phone:"",age:"",password:"",Email:"",departmentId:0,role:1,state:1},userCheckboxState:!0,password2:"",selectedTreeNode:{},selectedUserIds:"",reviseUserId:"",treeBtnType:"add",userBtnType:"add",userTableHeadData:[{prop:"phone",label:"账号",width:""},{prop:"name",label:"姓名",width:""},{prop:"sex",label:"性别",width:"",formatData:function(e){return"1"==e?"男":"女"}},{prop:"age",label:"年龄",width:""},{prop:"departmentName",label:"部门",width:""},{prop:"role",label:"角色",width:"",formatData:function(e){switch(e){case"1":return"管理员";case"2":return"操作员";case"3":return"审查员";case"4":return"游客";case"5":return"master"}}},{prop:"email",label:"邮箱",width:"150px"},{prop:"state",label:"状态",width:"",formatData:function(e){return"1"==e?"正常":"受限"}},{prop:"tools",label:"操作",width:"50px",btns:[{icon:"el-icon-edit",text:"修改用户",btnType:"reviseUser",clickFun:function(t){e.reviseUserBtn(t)}}]}],userTableData:[],userSearchFormItem:[{label:"姓名",paramName:"name",itemType:"",model:{model:""},type:"input"},{label:"账号",paramName:"phone",itemType:"",model:{model:""},type:"input"}],allUserCounts:0,pageSize:10,c_page:1,userSearchCondition:{name:"",phone:""},roleArr:[{value:1,label:"管理员"},{value:2,label:"操作员"},{value:3,label:"审查员"},{value:4,label:"游客"}],options:[]}},computed:{disabled:function(){return 5!==JSON.parse(localStorage.getItem("LoginUser")).role}},created:function(){var e=this;u.default.$on("searchUserCon",function(t){e.userSearchCondition=t,e.c_page=1,e.selectUser(1,t)}),u.default.$on(this.busName.selectionName,function(t){e.selectedUserIds="",t.forEach(function(t){e.selectedUserIds+=t.id+","})}),this.getDepartmentData()},mounted:function(){},watch:{userForm:function(){var e=this;this.userForm?(this.getDepartmentData(),u.default.$on("getValue",function(t){e.userParams.departmentId=t})):u.default.$off("getValue")},"userParams.password":function(e){e&&(this.mode=Object(d.b)(e))},"userParams.role":function(e){5===e&&this.roleArr.push({value:5,label:"master"})}},beforeDestroy:function(){u.default.$off("searchUserCon"),u.default.$off("getValue"),u.default.$off(this.busName.selectionName),u.default.$off(this.busName.reviseUserName)},methods:{getDepartmentData:function(){var e=this;this.$nextTick(function(){e.$axios.get(e.$baseUrl+"/department/selectAllDepartment.do",{}).then(function(t){e.options=t.data}).catch(function(e){})})},getTreeData:function(e,t){var a=this;this.depData=[],this.$nextTick(function(){a.$axios.post(a.$baseUrl+"/department/selectAll.do",a.$qs.stringify(e)).then(function(e){""!==e.data&&(e.data.department.forEach(function(e){a.depData.push(e)}),void 0!==e.data.user&&e.data.user[0].forEach(function(e){a.depData.push(e)}),t(a.depData),void 0!==e.data.user&&(a.changeUserShowData(e.data.user[0]),a.allUserCounts=e.data.user[0].length))}).catch(function(e){})})},loadNode:function(e,t){0===e.level?this.getTreeData({level:1},t):n()(e.data.id).length<10?this.getTreeData({id:e.data.id},t):t([])},nodeClick:function(e){e.departmentName?this.selectTreeUser(e.id):(this.fatherName=".. / "+e.name,this.selectedTreeNode={level:e.level,subordinate:e.subordinate,departmentNodeId:e.departmentNodeId,superiorId:e.superiorId,id:e.id,name:e.name,comment:e.comment})},addBtn:function(){this.treeBtnType="add",this.treeForm=!0,this.departmentParams=r()({},this.selectedTreeNode),this.departmentParams.name="",this.departmentParams.comment=""},addTree:function(){var e=this;layer.load(1),this.$nextTick(function(){e.$axios.post(e.$baseUrl+"/department/insert.do",e.$qs.stringify(e.departmentParams)).then(function(t){layer.closeAll(),"true"===t.data.success?(layer.msg("添加成功",{icon:1}),e.treeForm=!1,e.treeKey=+new Date):layer.msg(t.data.message,{icon:5})}).catch(function(e){layer.closeAll()})})},editBtn:function(){this.selectedTreeNode.id?(this.treeBtnType="edit",this.treeForm=!0,this.departmentParams=r()({},this.selectedTreeNode)):layer.msg("未选中任何组织",{icon:5})},editTree:function(){var e=this;layer.load(1),this.$nextTick(function(){e.$axios.post(e.$baseUrl+"/department/updateById.do",e.$qs.stringify(e.departmentParams)).then(function(t){layer.closeAll(),"true"===t.data.success?(layer.msg("修改成功",{icon:1}),e.treeForm=!1,e.treeKey=+new Date):layer.msg(t.data.message,{icon:5})}).catch(function(e){layer.closeAll()})})},removeTree:function(){var e=this;this.selectedTreeNode.id?layer.confirm("您确定删除么？",{btn:["确定","取消"]},function(t){layer.load(1),e.$nextTick(function(){e.$axios.post(e.$baseUrl+"/department/delete.do",e.$qs.stringify({id:e.selectedTreeNode.id})).then(function(t){layer.closeAll(),t.data?(layer.msg("删除成功",{icon:1}),e.selectedTreeNode={},e.treeKey=+new Date):layer.msg("删除失败，该目录存在子集",{icon:5})}).catch(function(e){layer.closeAll()})})}):layer.msg("未选中任何组织",{icon:5})},removeClass:function(e){"department-wapper"===$(e.target)[0].className&&(this.selectedTreeNode={},$(".el-tree--highlight-current").removeClass("el-tree--highlight-current"))},selectTreeUser:function(e){var t=this;layer.load(1),this.$nextTick(function(){t.$axios.get(t.$baseUrl+"/user/selectUser.do",{params:{id:e}}).then(function(e){layer.closeAll(),t.changeUserShowData(e.data[0])}).catch(function(e){layer.closeAll()})})},selectUser:function(e,t){var a=this;this.fatherName="",t.pageIndex=e,t.pageSize=this.pageSize,layer.load(1),this.$nextTick(function(){a.$axios.post(a.$baseUrl+"/user/selectAlls.do",a.$qs.stringify(t)).then(function(e){layer.closeAll(),a.allUserCounts=Number(e.data.count[0].count),a.changeUserShowData(e.data.user[0])}).catch(function(e){layer.closeAll()})})},changeUserShowData:function(e){this.userTableData=e},addUserBtn:function(){this.userBtnType="add",this.userParams={name:"",sex:1,phone:"",age:"",password:"",Email:"",departmentId:0,role:1},this.userForm=!0},addUser:function(){var e=this;this.checkUserParams(this.userParams)&&(layer.load(1),this.$nextTick(function(){e.$axios.post(e.$baseUrl+"/user/inserts.do",e.$qs.stringify(e.userParams)).then(function(t){layer.closeAll(),"true"===t.data.success?(layer.msg("添加成功",{icon:1}),e.userForm=!1,e.userParams={name:"",sex:1,phone:"",age:"",password:"",Email:"",departmentId:0,role:1},e.treeKey=+new Date,e.c_page=1,e.selectUser(1,e.userSearchCondition)):layer.msg(t.data.message,{icon:5})}).catch(function(e){layer.closeAll(),layer.msg("添加失败",{icon:5})})}))},removeUser:function(){var e=this;""===this.selectedUserIds?layer.msg("未选中任何用户",{icon:5}):layer.confirm("您确定删除么？",{btn:["确定","取消"]},function(t){layer.load(1),e.$nextTick(function(){e.$axios.post(e.$baseUrl+"/user/deletes.do",e.$qs.stringify({ids:e.selectedUserIds})).then(function(t){layer.closeAll(),"true"===t.data.success?(layer.msg("删除成功",{icon:1}),e.treeKey=+new Date,e.selectUser(1,e.userSearchCondition)):layer.msg("删除失败",{icon:5})}).catch(function(e){layer.closeAll()})})})},reviseUserBtn:function(e){var t=this;this.userForm=!0,this.userBtnType="revise",layer.load(1),this.$nextTick(function(){t.$axios.post(t.$baseUrl+"/user/selectById.do",t.$qs.stringify({id:e.id})).then(function(a){layer.closeAll(),t.userParams={name:a.data.name,sex:a.data.sex,phone:a.data.phone,age:a.data.age,Email:a.data.email,departmentId:a.data.departmentId,role:a.data.role},1===a.data.state?t.userCheckboxState=!1:t.userCheckboxState=!0,t.reviseUserId=e.id}).catch(function(e){layer.msg("获取用户信息失败",{icon:5}),layer.closeAll()})})},reviseUser:function(e){var t=this;this.userParams.id=this.reviseUserId,!0===this.userCheckboxState?this.userParams.state=0:this.userParams.state=1,this.checkUserParams(this.userParams)&&(layer.load(1),this.$nextTick(function(){t.$axios.post(t.$baseUrl+"/user/inserts.do",t.$qs.stringify(t.userParams)).then(function(e){layer.closeAll(),"true"===e.data.success?(layer.msg("修改成功",{icon:1}),t.userForm=!1,t.userParams={name:"",sex:1,phone:"",age:"",password:"",Email:"",departmentId:0,role:1},t.treeKey=+new Date,t.c_page=1,t.selectUser(1,t.userSearchCondition)):layer.msg(e.data.message,{icon:5})}).catch(function(e){layer.closeAll(),layer.msg("修改失败",{icon:5})})}))},handleCurrentChange:function(e){this.selectUser(e,this.userSearchCondition)},checkUserParams:function(e){if("add"===this.userBtnType){if(e.password.length<6||e.password.length>18)return layer.msg("密码长度不正确（6-18）",{icon:5}),!1;if(e.password!==this.password2)return layer.msg("两次密码不正确",{icon:5}),!1}return""!==e.phone&&11===e.phone.length&&$.isNumeric(e.phone)?0===e.departmentId?(layer.msg("未选中任何部门",{icon:5}),!1):""===e.name?(layer.msg("姓名不能为空",{icon:5}),!1):!!/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/.test(e.Email)||(layer.msg("邮箱格式不正确",{icon:5}),!1):(layer.msg("电话（账号）不能为空或格式不正确",{icon:5}),!1)}},components:{vBasetable:i.default,vSearchForm:o.default,vSelectTree:c.default}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content-bg"},[a("div",{staticClass:"top-title"},[e._v("用户管理")]),e._v(" "),a("div",{staticClass:"user-manage-content"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"department-wapper",on:{click:e.removeClass}},[a("div",{staticClass:"department-top"},[a("h5",[e._v("机构列表")]),e._v(" "),a("div",{staticClass:"department-btns"},[a("el-button",{attrs:{type:"primary",size:"mini",plain:"",title:"添加组织机构"},on:{click:e.addBtn}},[a("i",{staticClass:"el-icon-lx-add"})]),e._v(" "),a("el-button",{attrs:{type:"success",size:"mini",plain:"",title:"修改组织机构"},on:{click:e.editBtn}},[a("i",{staticClass:"el-icon-edit"})]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"mini",plain:"",title:"删除组织机构"},on:{click:e.removeTree}},[a("i",{staticClass:"el-icon-close"})])],1)]),e._v(" "),a("div",{staticClass:"department-content treeBox"},[a("el-tree",{key:e.treeKey,attrs:{props:e.props,load:e.loadNode,"highlight-current":"",lazy:""},on:{"node-click":e.nodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node;return t.data,a("span",{staticClass:"custom-tree-node"},[s.data.departmentName?a("span",{staticClass:"tree-label"},[a("span",{staticClass:"people-icon el-icon-lx-peoplefill"}),e._v(e._s(s.label)+"\n                                ")]):a("span",{staticClass:"tree-label"},[a("span",{staticClass:"tree-icon el-icon-lx-homefill"}),e._v(e._s(s.label)+"\n                                ")])])}}])})],1)])]),e._v(" "),a("el-col",{attrs:{span:18}},[a("div",{staticClass:"user-wapper"},[a("div",{staticClass:"user-department-name"},[e._v(e._s(e.fatherName.split("/")[1]))]),e._v(" "),a("div",{staticClass:"user-tools-wapper"},[a("div",{staticClass:"user-btn"},[a("el-button",{attrs:{type:"primary",size:"mini",plain:"",title:"添加用户"},on:{click:e.addUserBtn}},[a("i",{staticClass:"el-icon-lx-add"}),e._v("添加用户")]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"mini",plain:"",title:"删除用户"},on:{click:e.removeUser}},[a("i",{staticClass:"el-icon-close"}),e._v("删除用户")])],1),e._v(" "),a("div",{staticClass:"user-search"},[a("v-search-form",{attrs:{formItem:e.userSearchFormItem,busName:"searchUserCon"}})],1)]),e._v(" "),a("div",{staticClass:"user-table-wapper"},[a("v-basetable",{attrs:{selection:!0,tableHead:e.userTableHeadData,tableData:e.userTableData,busName:e.busName}})],1),e._v(" "),a("div",{staticClass:"user-page-wapper"},[e._v("\n                        共检索到用户"),a("b",[e._v(e._s(e.allUserCounts))]),e._v("人\n                        "),a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":e.c_page,"page-size":e.pageSize,total:e.allUserCounts},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.c_page=t},"update:current-page":function(t){e.c_page=t}}})],1)])])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"add"===e.treeBtnType?"添加组织机构":"修改组织机构",visible:e.treeForm,width:"440px"},on:{"update:visible":function(t){e.treeForm=t}}},[a("el-form",{attrs:{"label-width":"80px"}},["add"===e.treeBtnType?a("el-form-item",{attrs:{label:"父级目录:"}},[a("el-input",{staticClass:"item",attrs:{placeholder:"",disabled:""},model:{value:e.fatherName,callback:function(t){e.fatherName=t},expression:"fatherName"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"名称:"}},[a("el-input",{staticClass:"item",attrs:{placeholder:"名称"},model:{value:e.departmentParams.name,callback:function(t){e.$set(e.departmentParams,"name",t)},expression:"departmentParams.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述:"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:8,maxRows:10}},model:{value:e.departmentParams.comment,callback:function(t){e.$set(e.departmentParams,"comment",t)},expression:"departmentParams.comment"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){"add"===e.treeBtnType?e.addTree():e.editTree()}}},[e._v("确 定")]),e._v(" "),a("el-button",{on:{click:function(t){e.treeForm=!1}}},[e._v("取 消")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"add"===e.userBtnType?"添加用户":"修改用户",visible:e.userForm,width:"500px","close-on-click-modal":e.clickModal},on:{"update:visible":function(t){e.userForm=t}}},[a("el-form",{attrs:{"label-width":"100px"}},[a("el-form-item",{attrs:{label:"账号(电话):"}},[a("span",{staticStyle:{color:"red",position:"absolute",left:"-10px"}},[e._v("*")]),e._v(" "),a("el-input",{staticClass:"item",attrs:{placeholder:"11位有效数字",maxlength:"11"},model:{value:e.userParams.phone,callback:function(t){e.$set(e.userParams,"phone",t)},expression:"userParams.phone"}})],1),e._v(" "),"add"===e.userBtnType?a("el-form-item",{attrs:{label:"密码:"}},[a("span",{staticStyle:{color:"red",position:"absolute",left:"-10px"}},[e._v("*")]),e._v(" "),a("el-input",{staticClass:"item",attrs:{type:"password",placeholder:"6-18位数字、字母、字符",maxlength:"18"},model:{value:e.userParams.password,callback:function(t){e.$set(e.userParams,"password",t)},expression:"userParams.password"}})],1):e._e(),e._v(" "),""!==e.userParams.password&&void 0!==e.userParams.password?a("ul",{staticClass:"pass_set"},[a("li",{staticStyle:{"background-color":"rgb(237, 62, 13)"},attrs:{id:"strength_L"}},[e._v("弱")]),e._v(" "),a("li",{style:e.mode>=2?{background:"#ffaf56"}:{},attrs:{id:"strength_M"}},[e._v("中")]),e._v(" "),a("li",{style:e.mode>2?{background:"#6ba001"}:{},attrs:{id:"strength_H"}},[e._v("强")])]):e._e(),e._v(" "),"add"===e.userBtnType?a("el-form-item",{attrs:{label:"确认密码:"}},[a("span",{staticStyle:{color:"red",position:"absolute",left:"-10px"}},[e._v("*")]),e._v(" "),a("el-input",{staticClass:"item",attrs:{type:"password",placeholder:"确认密码",maxlength:"18"},model:{value:e.password2,callback:function(t){e.password2=t},expression:"password2"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"姓名:"}},[a("span",{staticStyle:{color:"red",position:"absolute",left:"-10px"}},[e._v("*")]),e._v(" "),a("el-input",{staticClass:"item",attrs:{placeholder:"姓名"},model:{value:e.userParams.name,callback:function(t){e.$set(e.userParams,"name",t)},expression:"userParams.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"部门:"}},[a("span",{staticStyle:{color:"red",position:"absolute",left:"-10px"}},[e._v("*")]),e._v(" "),a("v-select-tree",{attrs:{options:e.options,value:e.userParams.departmentId}})],1),e._v(" "),a("el-form-item",{attrs:{label:"角色:"}},[a("span",{staticStyle:{color:"red",position:"absolute",left:"-10px"}},[e._v("*")]),e._v(" "),a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",disabled:5===e.userParams.role},model:{value:e.userParams.role,callback:function(t){e.$set(e.userParams,"role",t)},expression:"userParams.role"}},e._l(e.roleArr,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"邮箱:"}},[a("span",{staticStyle:{color:"red",position:"absolute",left:"-10px"}},[e._v("*")]),e._v(" "),a("el-input",{staticClass:"item",attrs:{placeholder:"邮箱"},model:{value:e.userParams.Email,callback:function(t){e.$set(e.userParams,"Email",t)},expression:"userParams.Email"}})],1),e._v(" "),"add"!==e.userBtnType?a("el-form-item",{attrs:{label:"状态:"}},[a("el-checkbox",{attrs:{disabled:e.disabled},model:{value:e.userCheckboxState,callback:function(t){e.userCheckboxState=t},expression:"userCheckboxState"}},[e._v("限制登录")])],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"性别:"}},[a("el-radio-group",{model:{value:e.userParams.sex,callback:function(t){e.$set(e.userParams,"sex",t)},expression:"userParams.sex"}},[a("el-radio",{attrs:{label:1}},[e._v("男")]),e._v(" "),a("el-radio",{attrs:{label:0}},[e._v("女")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"年龄:"}},[a("el-input",{staticClass:"item",attrs:{type:"number",placeholder:"年龄"},model:{value:e.userParams.age,callback:function(t){e.$set(e.userParams,"age",t)},expression:"userParams.age"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){"add"===e.userBtnType?e.addUser():e.reviseUser()}}},[e._v("确 定")]),e._v(" "),a("el-button",{on:{click:function(t){e.userForm=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var h=a("C7Lr")(m,p,!1,function(e){a("PJ3e")},null,null);t.default=h.exports},PJ3e:function(e,t){}});